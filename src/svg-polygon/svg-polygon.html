<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/juicy-draggable/juicy-draggable.html">

<dom-module id="svg-polygon">
    <template>
        <style>
            :host {
                display: block;
                --main-color: #5E35B1
            }
            svg {
                fill:var(--main-color); 
            }
            .wrap {
                position: relative;
            }
            .drag {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                margin: -6px 0 0 -6px;
                position: absolute;
                box-sizing: border-box;
                background-color: var(--main-color);
                text-indent: -9999em;
                cursor: crosshair;
                border: 2px solid #fff;
            }
        </style>


<div class="wrap">

           
                
                <template is="dom-repeat" items="{{points}}">
 <juicy-draggable class="fixed-drop" on-juicy-draggable-stop="itemDropped" on-juicy-draggable-move="itemDropped">
                <div class="drag" style="top:[[item.y]]px; left: [[item.x]]px;">[[index]]</div>
    </juicy-draggable>
                </template>
        
 

<svg height="210" width="500">
    <polygon id="svg" points$="{{pointsString}}"></polygon>
</svg>
</div>

    </template>
    <script>
        Polymer({
            is: 'svg-polygon',
            properties: {
                points: {
                   type: Array,
                   value: function(){
                       return [
                           {x: 97, y: 0},
                           {x: 127.4, y: 60.9},
                           {x: 194.6, y: 70.7},
                           {x: 145.9, y: 118.1},
                           {x: 157.4, y: 185.1},
                           {x: 97.3, y: 153.5},
                           {x: 37.2, y: 185.1},
                           {x: 48.6, y: 118.1},
                           {x: 0, y: 70.7},
                           {x: 67.2, y: 60.9}
                       ]
                   }
                },
                pointsString: String
            },
            ready: function(){
                this.actualizarPuntos(this.points);
            },
            actualizar: function(p){
                var cadena = "";
                p.forEach(function(el){
                    cadena += el.x + "," + el.y + " ";
                });
                this.pointsString = cadena;
            },
            actualizarPuntos: function(p){
                var cadena = "";
                p.forEach(function(el){
                    cadena += el.x + "," + el.y + " ";
                });
                this.pointsString = cadena;
            },
            itemDropped: function(e){

               var num = parseInt(e.target.textContent);
               var newValue = {x: e.detail.x, y: e.detail.y};
               this.set('points.' + num , newValue);
               this.actualizarPuntos(this.points);
            },
            dibujar: function(e){
                this.$.svg.points = this.itemDropped(e);
                console.log(this.itemDropped(e))
            }
        });
    </script>
</dom-module>
